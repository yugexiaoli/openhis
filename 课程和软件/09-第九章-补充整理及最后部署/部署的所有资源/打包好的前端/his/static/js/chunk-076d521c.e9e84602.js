(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-076d521c"],{"40a4":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"app-container",attrs:{"element-loading-text":t.loadingText}},[r("el-form",{ref:"queryForm",attrs:{"label-width":"88px"}},[r("el-form-item",{attrs:{label:"挂号单ID",prop:"regId"}},[r("el-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入挂号单号",size:"small"},model:{value:t.regId,callback:function(e){t.regId=e},expression:"regId"}}),t._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:t.handleQuery}},[t._v("查询")]),t._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:t.handleQuery}},[t._v("读取IC卡")])],1)],1),t._v(" "),void 0!==t.careHistory.regId?r("div",[r("el-card",{staticStyle:{"margin-bottom":"5px"}},[r("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"right","label-width":"120px",inline:""}},[r("el-form-item",{attrs:{label:"挂号单号:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.regId)}})]),t._v(" "),r("el-form-item",{attrs:{label:"医生姓名:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.userName)}})]),t._v(" "),r("el-form-item",{attrs:{label:"科室名称:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.deptName)}})]),t._v(" "),r("el-form-item",{attrs:{label:" 患者姓名:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.patientName)}})]),t._v(" "),r("el-form-item",{attrs:{label:"就诊时间:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.careDate)}})]),t._v(" "),r("el-form-item",{attrs:{label:"主诉:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.caseTitle)}})]),t._v(" "),r("el-form-item",{attrs:{label:"诊断信息:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.caseResult)}})]),t._v(" "),r("el-form-item",{attrs:{label:"医生建议:"}},[r("span",{domProps:{textContent:t._s(t.careHistory.doctorTips)}})])],1)],1),t._v(" "),r("el-card",{staticStyle:{"margin-bottom":"5px"}},[r("el-button",{attrs:{type:"success",icon:"el-icon-finished"},on:{click:t.handleSelectAll}},[t._v("全选")]),t._v(" "),r("el-button",{attrs:{type:"success",icon:"el-icon-finished"},on:{click:t.handleUnSelectAll}},[t._v("取消全选")]),t._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-bank-card"},on:{click:t.handlePayWithCash}},[t._v("现金支付")]),t._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-bank-card"},on:{click:t.handlePayWithZfb}},[t._v("支付宝支付")]),t._v(" "),r("span",{staticStyle:{"margin-left":"20px"}},[t._v("订单总额:"),r("span",{staticStyle:{color:"red","margin-left":"20px"}},[t._v("￥:"+t._s(t.allAmount))])])],1),t._v(" "),r("el-card",{staticStyle:{"margin-bottom":"5px"}},[t.careOrders.length>0?r("el-collapse",{model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.careOrders,(function(e,a){return r("el-collapse-item",{key:a,attrs:{name:a}},[r("template",{slot:"title"},[t._v("\n            【"+t._s("0"===e.coType?"药用处方":"检查处方")+"】【"+t._s(a+1)+"】【处方总额】:￥"+t._s(e.allAmount)+"\n          ")]),t._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"refTable",refInFor:!0,attrs:{border:"",data:e.careOrderItems,"row-class-name":t.tableRowClassName},on:{"selection-change":function(r){return t.handleCareOrderItemSelectionChange(r,e.coId)}}},[r("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"序号",align:"center",type:"index",width:"50"}}),t._v(" "),r("el-table-column",{attrs:{label:"0"===e.coType?"药品名称":"项目名称",align:"center",prop:"itemName"}}),t._v(" "),r("el-table-column",{attrs:{label:"数量",align:"center",prop:"num"}}),t._v(" "),r("el-table-column",{attrs:{label:"单价(元)",align:"center",prop:"price"}}),t._v(" "),r("el-table-column",{attrs:{label:"金额(元)",align:"center",prop:"amount"}}),t._v(" "),r("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark"}}),t._v(" "),r("el-table-column",{attrs:{label:"状态",align:"center",prop:"status",formatter:t.statusFormatter}})],1)],2)})),1):t._e()],1)],1):r("div",{staticStyle:{"text-align":"center"}},[t._v("请输入正确的挂号单ID查询")]),t._v(" "),r("el-dialog",{attrs:{title:"请使用支付宝支付",visible:t.openPay,center:"","close-on-click-modal":!1,"before-close":t.handleClose,"append-to-body":""},on:{"update:visible":function(e){t.openPay=e}}},[r("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left","label-width":"120px",inline:""}},[r("el-card",[r("el-form-item",{attrs:{label:"订单号:"}},[r("span",[t._v(t._s(t.payObj.orderId))])]),t._v(" "),r("el-form-item",{attrs:{label:"总金额:"}},[r("span",[t._v(t._s(t.payObj.allAmount))])])],1)],1),t._v(" "),r("div",{staticStyle:{"text-align":"center"}},[r("vue-qr",{attrs:{text:t.payObj.payUrl,size:200}}),t._v(" "),r("div",[t._v("请使用支付宝扫码")])],1)],1)],1)},n=[],i=r("fc58"),o=r("658f"),s=r.n(o),l={components:{vueQr:s.a},data:function(){return{loading:!1,loadingText:"",regId:void 0,careHistory:{},careOrders:[],statusOptions:[],allAmount:0,itemObjs:[],activeNames:[],payObj:{},openPay:!1,intervalObj:void 0}},created:function(){var t=this;this.getDataByType("his_order_details_status").then((function(e){t.statusOptions=e.data}))},methods:{handleQuery:function(){var t=this;if(""===this.regId)return this.msgError("请输入挂号单号"),void this.resetCurrentParams();this.careHistory={},this.careOrders=[],this.itemObjs=[],this.loading=!0,this.loadingText="数据查询中，请稍后...",Object(i["c"])(this.regId).then((function(e){t.careHistory=e.data.careHistory,t.careOrders=e.data.careOrders,t.loading=!1,t.loadingText="",t.careOrders.filter((function(e,r){t.activeNames.push(r)}))})).catch((function(){t.msgError("查询失败"),t.loading=!1,t.loadingText=""}))},statusFormatter:function(t){return this.selectDictLabel(this.statusOptions,t.status)},handleCareOrderItemSelectionChange:function(t,e){var r=this;if(0===this.itemObjs.length)this.itemObjs=t;else{for(var a=0;a<this.itemObjs.length;a++){var n=this.itemObjs[a];n.coId===e&&(this.itemObjs.splice(a,1),a--)}t.filter((function(t){r.itemObjs.push(t)}))}this.computeAllAmount()},computeAllAmount:function(){var t=this;this.allAmount=0,this.itemObjs.filter((function(e){t.allAmount+=e.amount}))},tableRowClassName:function(t){var e=t.row,r=t.rowIndex;e.index=r},handleSelectAll:function(){var t=this.$refs.refTable;t.filter((function(t){t.clearSelection(),t.toggleAllSelection()}))},handleUnSelectAll:function(){var t=this.$refs.refTable;t.filter((function(t){t.clearSelection()}))},handlePayWithCash:function(){var t=this;if(this.careHistory.regId)if(0!==this.itemObjs.length){var e={orderChargeDto:{orderAmount:this.allAmount,chId:this.careHistory.chId,regId:this.careHistory.regId,patientName:this.careHistory.patientName},orderChargeItemDtoList:[]};this.itemObjs.filter((function(t){var r={itemId:t.itemId,coId:t.coId,itemName:t.itemName,itemPrice:t.price,itemNum:t.num,itemType:t.itemType,itemAmount:t.amount};e.orderChargeItemDtoList.push(r)})),this.loading=!0,this.loadingText="订单创建并现金支付中",this.$confirm("是否确定创建订单并使用现金支付?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(i["a"])(e).then((function(e){t.msgSuccess("订单创建并现金支付成功"),t.resetCurrentParams(),t.loading=!1})).catch((function(){t.msgError("创建订单失败"),t.loading=!1}))})).catch((function(){t.msgError("创建已取消"),t.loading=!1}))}else this.msgError("请选择要支付的项目");else this.msgError("请输入挂号单ID查询")},handlePayWithZfb:function(){var t=this;if(this.careHistory.regId)if(0!==this.itemObjs.length){var e={orderChargeDto:{orderAmount:this.allAmount,chId:this.careHistory.chId,regId:this.careHistory.regId,patientName:this.careHistory.patientName},orderChargeItemDtoList:[]};this.itemObjs.filter((function(t){var r={itemId:t.itemId,coId:t.coId,itemName:t.itemName,itemPrice:t.price,itemNum:t.num,itemType:t.itemType,itemAmount:t.amount};e.orderChargeItemDtoList.push(r)})),this.loading=!0,this.loadingText="订单创建并支付宝支付中",this.$confirm("是否确定创建订单并使用支付宝支付?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(i["b"])(e).then((function(e){t.payObj=e.data,t.msgSuccess("订单创建成功，请扫码支付");var r=t;r.openPay=!0,r.intervalObj=setInterval((function(){Object(i["g"])(r.payObj.orderId).then((function(t){"1"===t.data.orderStatus&&(clearInterval(r.intervalObj),r.$notify({title:"支付成功",message:"【"+r.payObj.orderId+"】的订单编写支付成功",type:"success"}),r.openPay=!1,r.resetCurrentParams())})).catch((function(){clearInterval(r.intervalObj)}))}),2e3),t.loading=!1})).catch((function(){t.msgError("创建订单失败"),t.loading=!1}))})).catch((function(){t.msgError("创建已取消"),t.loading=!1}))}else this.msgError("请选择要支付的项目");else this.msgError("请输入挂号单ID查询")},resetCurrentParams:function(){this.careHistory={},this.careOrders=[]},handleClose:function(){var t=this;this.$confirm("您确定放弃支付吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.msgError("您已放弃支付，可以回到收费查询列表里面再次支付"),t.resetCurrentParams(),t.openPay=!1,clearInterval(t.intervalObj)})).catch((function(){t.msgSuccess("欢迎继续支付")}))}}},c=l,d=(r("7962"),r("2877")),m=Object(d["a"])(c,a,n,!1,null,"5867d102",null);e["default"]=m.exports},7962:function(t,e,r){"use strict";var a=r("d757"),n=r.n(a);n.a},d757:function(t,e,r){},fc58:function(t,e,r){"use strict";r.d(e,"c",(function(){return n})),r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return o})),r.d(e,"g",(function(){return s})),r.d(e,"e",(function(){return l})),r.d(e,"f",(function(){return c})),r.d(e,"h",(function(){return d})),r.d(e,"d",(function(){return m}));var a=r("b775");function n(t){return Object(a["a"])({url:"/doctor/charge/getNoChargeCareHistoryByRegId/"+t,method:"get"})}function i(t){return Object(a["a"])({url:"/doctor/charge/createOrderChargeWithCash",method:"post",data:t})}function o(t){return Object(a["a"])({url:"/doctor/charge/createOrderChargeWithZfb",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/doctor/charge/queryOrderChargeOrderId/"+t,method:"get"})}function l(t){return Object(a["a"])({url:"/doctor/charge/queryAllOrderChargeForPage",method:"get",params:t})}function c(t){return Object(a["a"])({url:"/doctor/charge/queryOrderChargeItemByOrderId/"+t,method:"get"})}function d(t){return Object(a["a"])({url:"/doctor/charge/toPayOrderWithZfb/"+t,method:"get"})}function m(t){return Object(a["a"])({url:"/doctor/charge/payWithCash/"+t,method:"get"})}}}]);