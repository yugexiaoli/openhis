(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1902944a"],{"33c5":function(e,t,a){"use strict";var r=a("afbf"),n=a.n(r);n.a},"3f47":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"app-container",attrs:{"element-loading-text":e.loadingText}},[a("el-form",{ref:"queryForm",attrs:{"label-width":"88px"}},[a("el-form-item",{attrs:{label:"挂号单ID",prop:"regId"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入挂号单号",size:"small"},model:{value:e.regId,callback:function(t){e.regId=t},expression:"regId"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("读取IC卡")])],1)],1),e._v(" "),void 0!==e.careHistory.regId?a("div",[a("el-card",{staticStyle:{"margin-bottom":"5px"}},[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"right","label-width":"120px",inline:""}},[a("el-form-item",{attrs:{label:"挂号单号:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.regId)}})]),e._v(" "),a("el-form-item",{attrs:{label:"医生姓名:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.userName)}})]),e._v(" "),a("el-form-item",{attrs:{label:"科室名称:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.deptName)}})]),e._v(" "),a("el-form-item",{attrs:{label:" 患者姓名:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.patientName)}})]),e._v(" "),a("el-form-item",{attrs:{label:"就诊时间:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.careDate)}})]),e._v(" "),a("el-form-item",{attrs:{label:"主诉:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.caseTitle)}})]),e._v(" "),a("el-form-item",{attrs:{label:"诊断信息:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.caseResult)}})]),e._v(" "),a("el-form-item",{attrs:{label:"医生建议:"}},[a("span",{domProps:{textContent:e._s(e.careHistory.doctorTips)}})])],1)],1),e._v(" "),a("el-card",{staticStyle:{"margin-bottom":"5px"}},[a("el-button",{attrs:{type:"success",icon:"el-icon-finished"},on:{click:e.handleSelectAll}},[e._v("全选")]),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-finished"},on:{click:e.handleUnSelectAll}},[e._v("取消全选")]),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-bank-card"},on:{click:e.handleDoMedicine}},[e._v("发药")])],1),e._v(" "),a("el-card",{staticStyle:{"margin-bottom":"5px"}},[e.careOrders.length>0?a("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.careOrders,(function(t,r){return a("el-collapse-item",{key:r,attrs:{name:r}},[a("template",{slot:"title"},[e._v("\n            【药用处方】【"+e._s(r+1)+"】【处方总额】:￥"+e._s(t.allAmount)+"\n          ")]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"refTable",refInFor:!0,attrs:{border:"",data:t.careOrderItems,"row-class-name":e.tableRowClassName},on:{"selection-change":function(a){return e.handleCareOrderItemSelectionChange(a,t.coId)}}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"序号",align:"center",type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{label:"药品名称",align:"center",prop:"itemName"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量",align:"center",prop:"num"}}),e._v(" "),a("el-table-column",{attrs:{label:"单价(元)",align:"center",prop:"price"}}),e._v(" "),a("el-table-column",{attrs:{label:"金额(元)",align:"center",prop:"amount"}}),e._v(" "),a("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark"}}),e._v(" "),a("el-table-column",{attrs:{label:"状态",align:"center",prop:"status",formatter:e.statusFormatter}})],1)],2)})),1):e._e()],1)],1):a("div",{staticStyle:{"text-align":"center"}},[e._v("请输入正确的挂号单ID查询")])],1)},n=[],i=a("b775");function l(e){return Object(i["a"])({url:"/doctor/handleMedicine/getChargedCareHistoryOnlyMedicinesByRegId/"+e,method:"get"})}function s(e){return Object(i["a"])({url:"/doctor/handleMedicine/doMedicine",method:"post",data:e})}var o={data:function(){return{loading:!1,loadingText:"",regId:void 0,careHistory:{},careOrders:[],statusOptions:[],itemObjs:[],activeNames:[]}},created:function(){var e=this;this.getDataByType("his_order_details_status").then((function(t){e.statusOptions=t.data}))},methods:{handleQuery:function(){var e=this;if(""===this.regId)return this.msgError("请输入挂号单号"),void this.resetCurrentParams();this.careHistory={},this.careOrders=[],this.itemObjs=[],this.loading=!0,this.loadingText="数据查询中，请稍后...",l(this.regId).then((function(t){e.careHistory=t.data.careHistory,e.careOrders=t.data.careOrders,e.loading=!1,e.loadingText="",e.careOrders.filter((function(t,a){e.activeNames.push(a)}))})).catch((function(){e.msgError("查询失败"),e.loading=!1,e.loadingText=""}))},statusFormatter:function(e){return this.selectDictLabel(this.statusOptions,e.status)},handleCareOrderItemSelectionChange:function(e,t){var a=this;if(0===this.itemObjs.length)this.itemObjs=e;else{for(var r=0;r<this.itemObjs.length;r++){var n=this.itemObjs[r];n.coId===t&&(this.itemObjs.splice(r,1),r--)}e.filter((function(e){a.itemObjs.push(e)}))}},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;t.index=a},handleSelectAll:function(){var e=this.$refs.refTable;e.filter((function(e){e.clearSelection(),e.toggleAllSelection()}))},handleUnSelectAll:function(){var e=this.$refs.refTable;e.filter((function(e){e.clearSelection()}))},handleDoMedicine:function(){var e=this;if(this.careHistory.regId)if(0!==this.itemObjs.length){var t=this.itemObjs.map((function(e){return e.itemId}));this.loading=!0,this.loadingText="发药中。。。",this.$confirm("是否确定发药?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){s(t).then((function(t){e.msgSuccess("全部药品发放成功"),e.handleQuery(),e.loading=!1})).catch((function(){e.msgError("发放失败原因：看右上角"),e.loading=!1}))})).catch((function(){e.msgError("发药已取消"),e.loading=!1}))}else this.msgError("请选择要发药的药品名");else this.msgError("请输入挂号单ID查询")},resetCurrentParams:function(){this.careHistory={},this.careOrders=[]}}},c=o,d=(a("33c5"),a("2877")),m=Object(d["a"])(c,r,n,!1,null,"11e7864b",null);t["default"]=m.exports},afbf:function(e,t,a){}}]);