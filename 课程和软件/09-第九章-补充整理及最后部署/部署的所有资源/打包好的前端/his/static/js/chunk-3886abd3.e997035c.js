(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3886abd3"],{"529d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"98px"}},[a("el-form-item",{attrs:{label:"患者姓名",prop:"patientName"}},[a("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:"请输入患者姓名",clearable:"",size:"small"},model:{value:e.queryParams.patientName,callback:function(t){e.$set(e.queryParams,"patientName",t)},expression:"queryParams.patientName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"挂号单号",prop:"regId"}},[a("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:"请输入挂号单号",clearable:"",size:"small"},model:{value:e.queryParams.regId,callback:function(t){e.$set(e.queryParams,"regId",t)},expression:"queryParams.regId"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",data:e.orderChargeTableList}},[a("el-table-column",{attrs:{label:"订单号",align:"center",width:"210",prop:"orderId"}}),e._v(" "),a("el-table-column",{attrs:{label:"挂号单号",align:"center",width:"200",prop:"regId"}}),e._v(" "),a("el-table-column",{attrs:{label:"患者姓名",align:"center",prop:"patientName"}}),e._v(" "),a("el-table-column",{attrs:{label:"总金额",align:"center",prop:"orderAmount"}}),e._v(" "),a("el-table-column",{attrs:{label:"支付类型",align:"center",prop:"payType",formatter:e.payTypeFormatter}}),e._v(" "),a("el-table-column",{attrs:{label:"订单状态",prop:"orderStatus",align:"center",formatter:e.orderStatusFormatter}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"300px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-view",size:"mini"},on:{click:function(a){return e.handleViewItem(t.row)}}},[e._v("查看详情")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:"1"===t.row.orderStatus,icon:"el-icon-bank-card",size:"mini"},on:{click:function(a){return e.handlePayWithCash(t.row)}}},[e._v("现金收费")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:"1"===t.row.orderStatus,icon:"el-icon-bank-card",size:"mini"},on:{click:function(a){return e.handlePayWithZfb(t.row)}}},[e._v("支付宝收费")])]}}])})],1),e._v(" "),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{"current-page":e.queryParams.pageNum,"page-sizes":[5,10,20,30],"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:e.title,visible:e.open,width:"1000px",center:"","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.itemTableloading,expression:"itemTableloading"}],attrs:{border:"",data:e.orderChargeItemList}},[a("el-table-column",{attrs:{label:"详情ID",align:"center",width:"210",prop:"itemId"}}),e._v(" "),a("el-table-column",{attrs:{label:"处方ID",align:"center",width:"200",prop:"coId"}}),e._v(" "),a("el-table-column",{attrs:{label:"名称",align:"center",prop:"itemName"}}),e._v(" "),a("el-table-column",{attrs:{label:"价格",align:"center",prop:"itemPrice"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量",align:"center",prop:"itemNum"}}),e._v(" "),a("el-table-column",{attrs:{label:"小计",prop:"itemAmount",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"类型",align:"center",prop:"itemType"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s("0"===t.row.itemType?"药品":"检查")+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态",align:"center",prop:"status",formatter:e.statusFormatter}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("关 闭")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"请使用支付宝支付",visible:e.openPay,center:"","close-on-click-modal":!1,"before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.openPay=t}}},[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left","label-width":"120px",inline:""}},[a("el-card",[a("el-form-item",{attrs:{label:"订单号:"}},[a("span",[e._v(e._s(e.payObj.orderId))])]),e._v(" "),a("el-form-item",{attrs:{label:"总金额:"}},[a("span",[e._v(e._s(e.payObj.allAmount))])])],1)],1),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("vue-qr",{attrs:{text:e.payObj.payUrl,size:200}}),e._v(" "),a("div",[e._v("请使用支付宝扫码")])],1)],1)],1)},n=[],i=a("fc58"),o=a("658f"),l=a.n(o),s={components:{vueQr:l.a},data:function(){return{loading:!1,itemTableloading:!1,total:0,title:"",open:!1,queryParams:{pageNum:1,pageSize:10,patientName:void 0,regId:void 0},orderChargeTableList:[],payTypeOptions:[],orderStatusOptions:[],orderChargeItemList:[],statusOptions:[],payObj:{},openPay:!1,intervalObj:void 0}},created:function(){var e=this;this.getDataByType("his_pay_type_status").then((function(t){e.payTypeOptions=t.data})),this.getDataByType("his_order_charge_status").then((function(t){e.orderStatusOptions=t.data})),this.getDataByType("his_order_details_status").then((function(t){e.statusOptions=t.data})),this.listOrderCharge()},methods:{listOrderCharge:function(){var e=this;this.loading=!0,Object(i["e"])(this.queryParams).then((function(t){e.orderChargeTableList=t.data,e.total=t.total,e.loading=!1})).catch((function(){e.msgError("查询失败"),e.loading=!1}))},handleQuery:function(){this.listOrderCharge()},resetQuery:function(){this.resetForm("queryForm"),this.listOrderCharge()},handleSizeChange:function(e){this.queryParams.pageSize=e,this.listOrderCharge()},handleCurrentChange:function(e){this.queryParams.pageNum=e,this.listOrderCharge()},payTypeFormatter:function(e){return this.selectDictLabel(this.payTypeOptions,e.payType)},orderStatusFormatter:function(e){return this.selectDictLabel(this.orderStatusOptions,e.orderStatus)},statusFormatter:function(e){return this.selectDictLabel(this.statusOptions,e.status)},handleViewItem:function(e){var t=this;this.title="查询【"+e.patientName+"】支付订单详情",this.open=!0,this.itemTableloading=!0,Object(i["f"])(e.orderId).then((function(e){t.orderChargeItemList=e.data,t.itemTableloading=!1})).catch((function(){t.msgError("查询失败"),t.itemTableloading=!1}))},cancel:function(){this.open=!1},handlePayWithCash:function(e){var t=this;this.$confirm("是否确定现金支付?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Object(i["d"])(e.orderId).then((function(e){t.msgSuccess("现金支付成功"),t.loading=!1,t.listOrderCharge()})).catch((function(){t.msgError("现金支付失败"),t.loading=!1}))})).catch((function(){t.msgError("现金支付已取消"),t.loading=!1}))},handlePayWithZfb:function(e){var t=this;Object(i["h"])(e.orderId).then((function(e){t.payObj=e.data;var a=t;a.openPay=!0,a.intervalObj=setInterval((function(){Object(i["g"])(a.payObj.orderId).then((function(e){"1"===e.data.orderStatus&&(clearInterval(a.intervalObj),a.$notify({title:"支付成功",message:"【"+a.payObj.orderId+"】的订单编写支付成功",type:"success"}),a.openPay=!1,a.listOrderCharge())})).catch((function(){clearInterval(a.intervalObj)}))}),2e3)})).catch((function(){t.msgError("操作失败")}))},handleClose:function(){var e=this;this.$confirm("您确定放弃支付吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.msgError("您已放弃支付，可以回到收费查询列表里面再次支付"),e.openPay=!1,clearInterval(e.intervalObj)})).catch((function(){e.msgSuccess("欢迎继续支付")}))}}},c=s,u=(a("a0dc"),a("2877")),d=Object(u["a"])(c,r,n,!1,null,"022451a5",null);t["default"]=d.exports},"68de":function(e,t,a){},a0dc:function(e,t,a){"use strict";var r=a("68de"),n=a.n(r);n.a},fc58:function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"g",(function(){return l})),a.d(t,"e",(function(){return s})),a.d(t,"f",(function(){return c})),a.d(t,"h",(function(){return u})),a.d(t,"d",(function(){return d}));var r=a("b775");function n(e){return Object(r["a"])({url:"/doctor/charge/getNoChargeCareHistoryByRegId/"+e,method:"get"})}function i(e){return Object(r["a"])({url:"/doctor/charge/createOrderChargeWithCash",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/doctor/charge/createOrderChargeWithZfb",method:"post",data:e})}function l(e){return Object(r["a"])({url:"/doctor/charge/queryOrderChargeOrderId/"+e,method:"get"})}function s(e){return Object(r["a"])({url:"/doctor/charge/queryAllOrderChargeForPage",method:"get",params:e})}function c(e){return Object(r["a"])({url:"/doctor/charge/queryOrderChargeItemByOrderId/"+e,method:"get"})}function u(e){return Object(r["a"])({url:"/doctor/charge/toPayOrderWithZfb/"+e,method:"get"})}function d(e){return Object(r["a"])({url:"/doctor/charge/payWithCash/"+e,method:"get"})}}}]);