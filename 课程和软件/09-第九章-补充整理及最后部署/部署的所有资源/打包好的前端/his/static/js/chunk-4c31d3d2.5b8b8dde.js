(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c31d3d2"],{"25e1":function(e,t,r){"use strict";r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return l}));var a=r("b775");function i(e){return Object(a["a"])({url:"/doctor/backfee/getChargedCareHistoryByRegId/"+e,method:"get"})}function n(e){return Object(a["a"])({url:"/doctor/backfee/createOrderBackfeeWithCash",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/doctor/backfee/createOrderBackfeeWithZfb",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/doctor/backfee/queryAllOrderBackfeeForPage",method:"get",params:e})}function l(e){return Object(a["a"])({url:"/doctor/backfee/queryOrderBackfeeItemByBackId/"+e,method:"get"})}},"6dba":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"app-container",attrs:{"element-loading-text":e.loadingText}},[r("el-form",{ref:"queryForm",attrs:{"label-width":"88px"}},[r("el-form-item",{attrs:{label:"挂号单ID",prop:"regId"}},[r("el-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入挂号单号",size:"small"},model:{value:e.regId,callback:function(t){e.regId=t},expression:"regId"}}),e._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")]),e._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("读取IC卡")])],1)],1),e._v(" "),void 0!==e.careHistory.regId?r("div",[r("el-card",{staticStyle:{"margin-bottom":"5px"}},[r("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"right","label-width":"120px",inline:""}},[r("el-form-item",{attrs:{label:"挂号单号:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.regId)}})]),e._v(" "),r("el-form-item",{attrs:{label:"医生姓名:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.userName)}})]),e._v(" "),r("el-form-item",{attrs:{label:"科室名称:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.deptName)}})]),e._v(" "),r("el-form-item",{attrs:{label:" 患者姓名:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.patientName)}})]),e._v(" "),r("el-form-item",{attrs:{label:"就诊时间:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.careDate)}})]),e._v(" "),r("el-form-item",{attrs:{label:"主诉:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.caseTitle)}})]),e._v(" "),r("el-form-item",{attrs:{label:"诊断信息:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.caseResult)}})]),e._v(" "),r("el-form-item",{attrs:{label:"医生建议:"}},[r("span",{domProps:{textContent:e._s(e.careHistory.doctorTips)}})])],1)],1),e._v(" "),r("el-card",{staticStyle:{"margin-bottom":"5px"}},[r("el-button",{attrs:{type:"success",icon:"el-icon-finished"},on:{click:e.handleSelectAll}},[e._v("全选")]),e._v(" "),r("el-button",{attrs:{type:"success",icon:"el-icon-finished"},on:{click:e.handleUnSelectAll}},[e._v("取消全选")]),e._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-bank-card"},on:{click:e.handleBackfeeWithCash}},[e._v("现金退费")]),e._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-bank-card"},on:{click:e.handleBackfeeWithZfb}},[e._v("支付宝退费")]),e._v(" "),r("span",{staticStyle:{"margin-left":"20px"}},[e._v("订单总额:"),r("span",{staticStyle:{color:"red","margin-left":"20px"}},[e._v("￥:"+e._s(e.allAmount))])])],1),e._v(" "),r("el-card",{staticStyle:{"margin-bottom":"5px"}},[e.careOrders.length>0?r("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.careOrders,(function(t,a){return r("el-collapse-item",{key:a,attrs:{name:a}},[r("template",{slot:"title"},[e._v("\n            【"+e._s("0"===t.coType?"药用处方":"检查处方")+"】【"+e._s(a+1)+"】【处方总额】:￥"+e._s(t.allAmount)+"\n          ")]),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"refTable",refInFor:!0,attrs:{border:"",data:t.careOrderItems,"row-class-name":e.tableRowClassName},on:{"selection-change":function(r){return e.handleCareOrderItemSelectionChange(r,t.coId)}}},[r("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"序号",align:"center",type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{label:"0"===t.coType?"药品名称":"项目名称",align:"center",prop:"itemName"}}),e._v(" "),r("el-table-column",{attrs:{label:"数量",align:"center",prop:"num"}}),e._v(" "),r("el-table-column",{attrs:{label:"单价(元)",align:"center",prop:"price"}}),e._v(" "),r("el-table-column",{attrs:{label:"金额(元)",align:"center",prop:"amount"}}),e._v(" "),r("el-table-column",{attrs:{label:"备注",align:"center",prop:"remark"}}),e._v(" "),r("el-table-column",{attrs:{label:"状态",align:"center",prop:"status",formatter:e.statusFormatter}})],1)],2)})),1):e._e()],1)],1):r("div",{staticStyle:{"text-align":"center"}},[e._v("请输入正确的挂号单ID查询")])],1)},i=[],n=r("25e1"),o={data:function(){return{loading:!1,loadingText:"",regId:void 0,careHistory:{},careOrders:[],statusOptions:[],allAmount:0,itemObjs:[],activeNames:[]}},created:function(){var e=this;this.getDataByType("his_order_details_status").then((function(t){e.statusOptions=t.data}))},methods:{handleQuery:function(){var e=this;if(""===this.regId)return this.msgError("请输入挂号单号"),void this.resetCurrentParams();this.careHistory={},this.careOrders=[],this.itemObjs=[],this.loading=!0,this.loadingText="数据查询中，请稍后...",Object(n["c"])(this.regId).then((function(t){e.careHistory=t.data.careHistory,e.careOrders=t.data.careOrders,e.loading=!1,e.loadingText="",e.careOrders.filter((function(t,r){e.activeNames.push(r)}))})).catch((function(){e.msgError("查询失败"),e.loading=!1,e.loadingText=""}))},statusFormatter:function(e){return this.selectDictLabel(this.statusOptions,e.status)},handleCareOrderItemSelectionChange:function(e,t){var r=this;if(0===this.itemObjs.length)this.itemObjs=e;else{for(var a=0;a<this.itemObjs.length;a++){var i=this.itemObjs[a];i.coId===t&&(this.itemObjs.splice(a,1),a--)}e.filter((function(e){r.itemObjs.push(e)}))}this.computeAllAmount()},computeAllAmount:function(){var e=this;this.allAmount=0,this.itemObjs.filter((function(t){e.allAmount+=t.amount}))},tableRowClassName:function(e){var t=e.row,r=e.rowIndex;t.index=r},handleSelectAll:function(){var e=this.$refs.refTable;e.filter((function(e){e.clearSelection(),e.toggleAllSelection()}))},handleUnSelectAll:function(){var e=this.$refs.refTable;e.filter((function(e){e.clearSelection()}))},handleBackfeeWithCash:function(){var e=this;if(this.careHistory.regId)if(0!==this.itemObjs.length){var t={orderBackfeeDto:{backAmount:this.allAmount,chId:this.careHistory.chId,regId:this.careHistory.regId,patientName:this.careHistory.patientName},orderBackfeeItemDtoList:[]};this.itemObjs.filter((function(e){var r={itemId:e.itemId,coId:e.coId,itemName:e.itemName,itemPrice:e.price,itemNum:e.num,itemType:e.itemType,itemAmount:e.amount};t.orderBackfeeItemDtoList.push(r)})),this.loading=!0,this.loadingText="订单创建并现金退费中",this.$confirm("是否确定创建订单并使用现金退费?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["a"])(t).then((function(t){e.resetCurrentParams(),e.msgSuccess("现金退费成功"),e.loading=!1})).catch((function(){e.msgError("创建已取消"),e.loading=!1}))})).catch((function(){e.msgError("创建已取消"),e.loading=!1}))}else this.msgError("请选择要退费的项目");else this.msgError("请输入挂号单ID查询")},handleBackfeeWithZfb:function(){var e=this;if(this.careHistory.regId)if(0!==this.itemObjs.length){var t={orderBackfeeDto:{backAmount:this.allAmount,chId:this.careHistory.chId,regId:this.careHistory.regId,patientName:this.careHistory.patientName},orderBackfeeItemDtoList:[]};this.itemObjs.filter((function(e){var r={itemId:e.itemId,coId:e.coId,itemName:e.itemName,itemPrice:e.price,itemNum:e.num,itemType:e.itemType,itemAmount:e.amount};t.orderBackfeeItemDtoList.push(r)})),this.loading=!0,this.loadingText="订单创建并支付宝退费中",this.$confirm("是否确定创建订单并使用支付宝退纲?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["b"])(t).then((function(t){e.resetCurrentParams(),e.msgSuccess("支付宝退费成功"),e.loading=!1})).catch((function(){e.msgError("创建已取消"),e.loading=!1}))})).catch((function(){e.msgError("创建已取消"),e.loading=!1}))}else this.msgError("请选择要退费的项目");else this.msgError("请输入挂号单ID查询")},resetCurrentParams:function(){this.careHistory={},this.careOrders=[]}}},s=o,l=(r("86ce"),r("2877")),c=Object(l["a"])(s,a,i,!1,null,"af0a5e9c",null);t["default"]=c.exports},"86ce":function(e,t,r){"use strict";var a=r("eadf"),i=r.n(a);i.a},eadf:function(e,t,r){}}]);